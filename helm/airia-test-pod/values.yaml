# ===============================================================================
# AIRIA TEST POD - DEFAULT CONFIGURATION
# ===============================================================================
# This Helm chart deploys an infrastructure validation tool that tests various
# services and configurations in your Kubernetes environment.
#
# Each test appears as a card in the web UI dashboard at http://your-ingress-url/
# Tests can be run individually or all at once to validate infrastructure readiness.
# ===============================================================================

# Default values for airia-test-pod
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# ===============================================================================
# DEPLOYMENT CONFIGURATION
# ===============================================================================

replicaCount: 1

image:
  repository: ghcr.io/davidpacold/airia-test-pod
  pullPolicy: Always
  # tag defaults to .Chart.AppVersion if not specified
  # The chart automatically prepends 'v' prefix (e.g., v1.0.170)

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# ===============================================================================
# KUBERNETES RESOURCES
# ===============================================================================
# Configure Kubernetes-specific settings for the test pod deployment.
# These settings control security, networking, and resource management.
# ===============================================================================

# ---------------------------------------------------------------------------
# SERVICE ACCOUNT
# ---------------------------------------------------------------------------
# Service accounts provide an identity for processes running in pods.
# The test pod needs a service account to:
# - Create/delete PVCs for storage testing
# - Access Kubernetes API for cluster information
# - Run tests that validate Kubernetes functionality
serviceAccount:
  create: true  # Automatically create a service account for the pod
  annotations: {}  # Add cloud provider annotations if needed (e.g., AWS IAM roles)
  # Example for AWS EKS with IAM roles for service accounts (IRSA):
  # annotations:
  #   eks.amazonaws.com/role-arn: arn:aws:iam::123456789012:role/airia-test-pod
  name: ""  # Leave empty to auto-generate name based on release name

# ---------------------------------------------------------------------------
# POD ANNOTATIONS
# ---------------------------------------------------------------------------
# Annotations to add to the pod (key-value pairs for metadata).
# Useful for integrations with monitoring, logging, or service mesh.
podAnnotations: {}
# Example annotations:
# podAnnotations:
#   prometheus.io/scrape: "true"  # Enable Prometheus scraping
#   prometheus.io/port: "8080"  # Port for metrics
#   sidecar.istio.io/inject: "false"  # Disable Istio sidecar injection

# ---------------------------------------------------------------------------
# POD SECURITY CONTEXT
# ---------------------------------------------------------------------------
# Security settings that apply to all containers in the pod.
# Controls filesystem access, user/group IDs, and system capabilities.
# These settings affect how the pod interacts with the host system.
podSecurityContext: {}
  # Common pod security settings (uncomment to enable):
  # fsGroup: 2000  # Set filesystem group ID for mounted volumes
  # runAsNonRoot: true  # Require containers to run as non-root user
  # runAsUser: 1000  # User ID to run all container processes
  # runAsGroup: 3000  # Group ID for all container processes
  # fsGroupChangePolicy: "OnRootMismatch"  # When to recursively change volume ownership
  # seccompProfile:  # Seccomp (secure computing mode) profile
  #   type: RuntimeDefault  # Use default seccomp profile for security

# ---------------------------------------------------------------------------
# CONTAINER SECURITY CONTEXT
# ---------------------------------------------------------------------------
# Security settings specific to the test pod container.
# More restrictive than podSecurityContext but may limit some test functionality.
#
# NOTE: Some security restrictions may interfere with tests:
# - readOnlyRootFilesystem: May prevent temporary file writes
# - dropping ALL capabilities: May prevent certain network/system tests
securityContext: {}
  # Recommended security settings (uncomment as needed):
  # capabilities:  # Linux capabilities to add/drop
  #   drop:
  #   - ALL  # Drop all capabilities for maximum security
  #   add:
  #   - NET_BIND_SERVICE  # Allow binding to ports < 1024 if needed
  # readOnlyRootFilesystem: true  # Make container filesystem read-only
  # runAsNonRoot: true  # Prevent running as root user
  # runAsUser: 1000  # Specific user ID to run as (must be non-root)
  # allowPrivilegeEscalation: false  # Prevent gaining more privileges
  # privileged: false  # Don't run in privileged mode (never recommended)

# ---------------------------------------------------------------------------
# SERVICE CONFIGURATION
# ---------------------------------------------------------------------------
# Kubernetes Service exposes the test pod within the cluster.
# The ingress controller routes external traffic to this service.
#
# Service Type Guide:
# - ClusterIP: Internal cluster access only (recommended when using ingress)
# - LoadBalancer: Creates cloud load balancer for direct external access
# - NodePort: Exposes on each node's IP at a static port (30000-32767)
service:
  type: ClusterIP  # Use ClusterIP when using ingress

  port: 80  # Port that the service listens on (ingress connects here)
  targetPort: 8080  # Port inside the container (FastAPI app listens here)

  # Only used if type: NodePort
  # nodePort: 30000  # Must be in range 30000-32767
  # Service accessible at: http://<any-node-ip>:30000

# ===============================================================================
# INGRESS CONFIGURATION
# ===============================================================================
# Configures how external traffic reaches the test pod.
# The ingress creates routes for the web UI and API endpoints.
ingress:
  enabled: true
  className: "nginx"
  annotations:
    # Disable SSL redirect (configure SSL at load balancer or reverse proxy level)
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    # Max upload size for AI model file uploads (OpenAI, Document Intelligence, Llama)
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
  hosts:
    # Replace with your actual domain
    - host: test.example.com
      paths:
        - path: /
          pathType: Prefix
  # Add additional hostnames if needed:
  # - host: validation.example.com
  #   paths:
  #     - path: /
  #       pathType: Prefix
  tls: []
    # Uncomment to enable TLS (requires cert-manager or manual certificate creation)
    # - secretName: airia-test-pod-tls
    #   hosts:
    #     - test.example.com

# ===============================================================================
# RESOURCE LIMITS
# ===============================================================================
resources:
  limits:
    cpu: 500m
    memory: 512Mi
    # Uncomment to allocate a GPU to the pod (shows GPU test in UI)
    # Requires GPU-enabled Kubernetes node with NVIDIA drivers
    # nvidia.com/gpu: 1
  requests:
    cpu: 100m
    memory: 256Mi
    # Uncomment to request GPU allocation
    # nvidia.com/gpu: 1

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}

# ===============================================================================
# APPLICATION CONFIGURATION
# ===============================================================================
# Each enabled test appears as a card in the web UI dashboard.
# Configure credentials and endpoints for the services you want to validate.
# ===============================================================================

config:
  # ---------------------------------------------------------------------------
  # AUTHENTICATION (Required)
  # ---------------------------------------------------------------------------
  # Credentials for accessing the web UI dashboard
  # Default: username=admin, password=changeme
  # IMPORTANT: Change these in production!
  auth:
    username: "admin"
    password: "changeme"
    secretKey: "your-super-secret-key-change-this"  # Used for JWT tokens

  # ---------------------------------------------------------------------------
  # POSTGRESQL DATABASE TEST (Optional)
  # ---------------------------------------------------------------------------
  # UI Card: "PostgreSQL Database"
  # Tests: Connection, query execution, SSL/TLS, connection pooling
  # Set enabled: true to show this test in the UI
  postgresql:
    enabled: false
    host: "your-postgres-server.postgres.database.azure.com"
    port: "5432"
    database: "postgres"
    sslmode: "require"  # Options: disable, require, verify-ca, verify-full
    username: ""
    password: ""

  # ---------------------------------------------------------------------------
  # APACHE CASSANDRA TEST (Optional)
  # ---------------------------------------------------------------------------
  # UI Card: "Apache Cassandra"
  # Tests: Connection, keyspace access, read/write operations, multi-node
  # Set enabled: true to show this test in the UI
  cassandra:
    enabled: false
    hosts: ""  # Comma-separated list: host1,host2,host3
    port: "9042"
    username: ""
    password: ""
    keyspace: ""  # Optional: specific keyspace to test
    datacenter: "datacenter1"  # Optional: leave empty for single-DC
    useSsl: false

  # ---------------------------------------------------------------------------
  # AZURE BLOB STORAGE TEST (Optional)
  # ---------------------------------------------------------------------------
  # UI Card: "Azure Blob Storage"
  # Tests: Connection, container access, file upload/download, permissions
  # Set enabled: true to show this test in the UI
  blobStorage:
    enabled: false
    accountName: ""
    accountKey: ""
    containerName: "test-container"

  # ---------------------------------------------------------------------------
  # AZURE OPENAI TEST (Optional)
  # ---------------------------------------------------------------------------
  # UI Card: "Azure OpenAI"
  # Tests: Chat completion, embedding generation, API connectivity
  # Supports custom prompts and file uploads through UI
  # Set enabled: true to show this test in the UI
  openai:
    enabled: false
    endpoint: "https://your-openai.openai.azure.com/"
    apiKey: ""
    deploymentName: "gpt-35-turbo"
    embeddingDeployment: ""  # Optional: for embedding tests

  # ---------------------------------------------------------------------------
  # AZURE DOCUMENT INTELLIGENCE TEST (Optional)
  # ---------------------------------------------------------------------------
  # UI Card: "Document Intelligence"
  # Tests: Document analysis, OCR, form recognition, table extraction
  # Supports PDF, image, and document file uploads through UI
  # Set enabled: true to show this test in the UI
  documentIntelligence:
    enabled: false
    endpoint: "https://your-doc-intel.cognitiveservices.azure.com/"
    apiKey: ""
    model: "prebuilt-document"

  # ---------------------------------------------------------------------------
  # SSL CERTIFICATE TEST (Optional)
  # ---------------------------------------------------------------------------
  # UI Card: "SSL Certificate Validation"
  # Tests: Certificate validity, expiration dates, chain validation, TLS versions
  # Monitors multiple URLs and warns when certificates expire soon
  # Set enabled: true to show this test in the UI
  ssl:
    enabled: false
    testUrls: "https://api.example.com,https://app.example.com"  # Comma-separated
    connectTimeout: 10  # Seconds
    warningDays: 30  # Warn if certificate expires within this many days

  # ---------------------------------------------------------------------------
  # KUBERNETES STORAGE TEST (Always Enabled)
  # ---------------------------------------------------------------------------
  # UI Card: "Kubernetes PVC Storage"
  # Tests: PVC creation, mounting, read/write operations, cleanup
  # This test always appears in the UI to validate Kubernetes storage
  kubernetes:
    storageClass: "default"  # StorageClass to use for test PVC
    testPvcSize: "1Gi"  # Size of test PVC

  # ---------------------------------------------------------------------------
  # GPU DETECTION TEST (Optional)
  # ---------------------------------------------------------------------------
  # UI Card: "GPU Detection"
  # Tests: NVIDIA GPU presence, driver version, CUDA availability, memory
  # Shows GPU information if available, or reports no GPU found
  # Set enabled: true to show this test in the UI
  # Note: Requires GPU node and nvidia.com/gpu resource allocation (see resources section)
  gpu:
    enabled: true
    required: false  # Set to true to FAIL the test if no GPU is found

  # ---------------------------------------------------------------------------
  # MINIO S3-COMPATIBLE STORAGE TEST (Optional)
  # ---------------------------------------------------------------------------
  # UI Card: "MinIO Storage"
  # Tests: Connection, bucket access, file upload/download/delete, encryption
  # Compatible with MinIO and other S3-compatible storage
  # Set enabled: true to show this test in the UI
  minio:
    enabled: false
    endpointUrl: "https://minio.example.com"
    accessKey: ""
    secretKey: ""
    bucketName: "test-bucket"
    secure: true  # Use HTTPS

  # ---------------------------------------------------------------------------
  # AMAZON S3 STORAGE TEST (Optional)
  # ---------------------------------------------------------------------------
  # UI Card: "Amazon S3 Storage"
  # Tests: Connection, bucket access, file upload/download/delete, encryption, versioning
  # Supports IAM roles, access keys, and temporary credentials
  # Set enabled: true to show this test in the UI
  s3:
    enabled: false
    region: "us-east-1"
    accessKeyId: ""
    secretAccessKey: ""
    sessionToken: ""  # Optional for temporary credentials (IAM roles)
    bucketName: "test-bucket"
    endpointUrl: ""  # Optional: for custom S3-compatible endpoints

  # ---------------------------------------------------------------------------
  # EMBEDDING MODEL TEST (Optional)
  # ---------------------------------------------------------------------------
  # UI Card: "Embedding Generation"
  # Tests: Text embedding generation, batch processing, API connectivity
  # Supports OpenAI and custom embedding endpoints
  # Set enabled: true to show this test in the UI
  embeddings:
    enabled: false
    baseUrl: "https://api.openai.com/v1"  # OpenAI or custom endpoint
    apiKey: ""
    modelName: "text-embedding-ada-002"
    customHeaders: ""  # Optional: Header1:Value1,Header2:Value2

  # ---------------------------------------------------------------------------
  # LLAMA MODEL TEST (Optional)
  # ---------------------------------------------------------------------------
  # UI Card: "Llama Model"
  # Tests: Text generation, chat completion, custom prompts
  # Supports Ollama and custom Llama endpoints
  # Supports custom prompts and file uploads through UI
  # Set enabled: true to show this test in the UI
  llama:
    enabled: false
    baseUrl: "http://localhost:11434"  # Ollama or custom endpoint
    apiKey: ""
    modelName: "llama2"
    maxTokens: 2048
    temperature: 0.7
    timeout: 30

# ===============================================================================
# NAMESPACE CONFIGURATION
# ===============================================================================
namespace:
  create: false  # Set to true to create a new namespace
  name: "airia-preprod"  # Namespace name if create is true

# ===============================================================================
# VERSION CHECKING (Optional)
# ===============================================================================
# Helps ensure you're deploying the latest version of the chart
versionCheck:
  enabled: true  # Check for newer versions during helm upgrade
  useOCI: true  # Use OCI registry for version checks
  ociRepo: "oci://ghcr.io/davidpacold/airia-test-pod/charts"
  strict: false  # false = warn about newer versions, true = block old versions

# ===============================================================================
# NGINX INGRESS CONTROLLER CONFIGURATION
# ===============================================================================
# Automatically deploys NGINX Ingress Controller for routing traffic to the test pod.
# This is enabled by default for out-of-the-box functionality.
#
# IMPORTANT: Set enabled: false if you already have an ingress controller
# in your cluster to avoid conflicts and duplicate load balancers.
# ===============================================================================
ingress-nginx:
  enabled: true  # Set to false if you have an existing ingress controller
  controller:
    # Watch all ingresses in the cluster (not just those with ingressClassName)
    watchIngressWithoutClass: true
    # Watch ALL namespaces (not just the one where controller is deployed)
    scope:
      enabled: false
    # Make this the default ingress class in the cluster
    ingressClassResource:
      default: true
    # Service configuration - creates a LoadBalancer for external access
    service:
      type: LoadBalancer  # Creates cloud load balancer (NLB/ALB/etc)
      # Cloud provider annotations (uncomment as needed):
      #
      # AWS - Network Load Balancer (recommended for production):
      # annotations:
      #   service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
      #   service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"
      #   service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
      #
      # Azure - Public Load Balancer:
      # annotations:
      #   service.beta.kubernetes.io/azure-load-balancer-internal: "false"
      #
      # GCP - Load Balancer (no annotations needed):
      #   Default LoadBalancer type works out of the box